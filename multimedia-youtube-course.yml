---
- hosts: main
  vars:
    remote_directory: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66323666356439613566316635383331383834663938393630323862656434386561646164666332
          3337313336356434343361396633626133633634313062640a323934666464626630343730313364
          65643761363061353432306335373163333363323066656561343937626237396539333336373236
          6665646465396163350a626661336661643238353633613066633539316564326432393933666236
          30663638653534313263303539396237643731663733333636636430366333643236
    project_directory: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36616233393263646337383636613138653366623762336639346563376666613263643666353130
          3535336338373938653436353930626662623231363564650a363465633734616632303636316262
          30393061643462303034666239653033653630633736343661336232313863326239393334633265
          6661633132353565660a643736366630626630396164373736396336663763656334336263633231
          61653539623064663730393264313633313664373139366362653230663966306334653038666239
          39613963633831643131326139393731613365646465363238343562643661613266363161623038
          35313030643035643065373066623839303835326636653537386661323633363264333432343363
          35396364386438666532636563346564396165383464383831653837623134623530656430643138
          6364

  tasks:
    - name: Create temporary directory
      file:
        path: "{{ remote_directory }}"
        state: directory
    - name: Copy project
      copy:
        src: "{{ project_directory }}"
        dest: "{{ remote_directory }}"
    - name: Set bin/run as executable
      file:
        path: "{{ remote_directory }}/gathering/bin/run"
        mode: "u=rwx,g=,o="
    - name: Run Docker container every third hour
      cron:
        name: Run Multimedia Pytomo Docker container
        minute: "0"
        hour: "*/3"
        job: "cd {{ remote_directory }}/gathering && python3 run.py"
        disabled: yes
