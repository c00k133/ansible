---
- hosts: main
  vars:
    remote_directory: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39336537393665343666393062316135633536353833323163613062323562636262306132336336
          6464376230336631643732393539646437663836353931630a616539623435363133383661323231
          36656362396534663033363232663862313962333536643262346433633130393134613264363962
          6362663565313230320a633039343265326439323034313864373338353863633130623437336232
          32623631356231343639646334323564346635313630653734616637383361373764636230653238
          3237613266356463643431656662616132613738656135343964
    project_directory: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39303336633339343564616466303466346430353464313364343632356638623837633665346365
          3862303064663039333361623165343937376330336237640a613535373666343735363362623839
          38653832383133636632316531613533613962306565386530376438336462633530356537323963
          3361653236316163620a323637393161643263653133643164306465663834626337656537306334
          64613338666433663966616565323963323835643137363864663435333837623131303831333839
          63393631396631376232353830663530616134646333643361623639343739386131383832306261
          65663061343130333435393739666136623038643036343239363030373835316334616639623931
          62636232336262643437656661333739303562643538643436363239303034363139356265376166
          3237
  tasks:
    - name: Create temporary directory
      file:
        path: "{{ remote_directory }}"
        state: directory
    - name: Copy project
      copy:
        src: "{{ project_directory }}"
        dest: "{{ remote_directory }}"
    - name: Set bin/run as executable
      file:
        path: "{{ remote_directory }}/gathering/bin/run"
        mode: "u=rwx,g=,o="
    - name: Run Docker container every third hour
      cron:
        name: Run Multimedia Pytomo Docker container on own videos
        minute: "0"
        hour: "*/3"
        job: "cd {{ remote_directory }}/gathering && python3 run.py"
        disabled: yes
