---
- hosts: main
  vars:
    local_project_directory: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37343064626335366666666332373536656331313538666461626563366136656463393530343738
          3434366362643539326165353063393164313034663032360a326164363564633462373066336363
          38343561343737363136623732313230323462326131646133356235363465323566613539316434
          3061373932316162390a383330306137353565623739653735653962323634353863343866366130
          33366631353334653364376464373865373038336132366233653436666535643331623963383831
          39653961396239393763333461363039656232653565373432656535663432653731343932653430
          39396639626666306164333236663630396231373031646632613962323264633961393236303165
          62303739386261303330653338633039386461386137366335616566663038623337613861366266
          3562
    data_directory: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36666431323862303534666437306165393634666263316233623939363638353365333133386462
          3762613562343731663663393330333566313362376336620a653961653761343661353237313936
          38396263656263653832316631366163313866313661346565636661663037346133323034663432
          3365316162303962640a353039633531393130313465613135663234346161633634346337633663
          33633134303063623131366364396262306538393935653564636538613165663130666265346339
          3661313566316538646235616466623032343137303864383632
    http_image: "httpd:2.4"
    publishing_port: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35373761623962626565623435653536313134343233333733363863333963306265633139353731
          3437396435386665383938363661643265386631343130330a326664393165633562356661643233
          66376537393565653564373239363533653163396431333866343039306566393839633462396332
          6130393437633962300a373239373231376661623866353833336235646435356265323266643362
          3033
    data_dir_owner: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30366466653631666135646666633661643930343233653031616235366463346663633664303261
          3631663766666161353432666135356633333332653065660a333562636231326138363762366139
          34346532646133633936346230373433343165633739303630313765303631363666666437303865
          6665333138346662630a623134663864323166623466336339643538633462353666373636313466
          3262

  tasks:
    - name: Create data directory
      become: true
      file:
        path: "{{ data_directory }}"
        owner: "{{ data_dir_owner }}"
        state: directory
    - name: rsync project and data directory
      synchronize:
        src: "{{ local_project_directory }}"
        dest: "{{ data_directory }}"
    - name: Build httpd Docker container
      docker_container:
        name: multimedia-adaptive-streaming
        image: "{{ http_image }}"
        state: started
        restart: yes
        ports:
          - "127.0.0.1:{{ publishing_port }}:80"
        volumes:
          - "{{ data_directory }}/htdocs:/usr/local/apache2/htdocs"
